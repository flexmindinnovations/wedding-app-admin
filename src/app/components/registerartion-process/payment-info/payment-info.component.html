<div class="personal-info-container h-full flex flex-col gap-5 items-center justify-center md:lg:ion-padding">
  <div class="form-wrapper w-full flex-auto flex items-center justify-center h-full overflow-auto">
    @if (isLoading) {
    <div class="flex h-full w-full items-center justify-center">
      <i class="pi pi-spin pi-spinner" style="font-size: 2.5rem;"></i>
    </div>
    } @else if (isPaymentInfoFill) {
    <div class="payment-info w-full h-full">
      <div class="personal-info w-full h-auto py-3">
        <h5 class="block border-b">Latest Payment Information</h5>
        <ul class="grid lg:grid-cols-3 mt-2 md:grid-cols-2 xl:grid-cols-5 gap-5">
          <li class="itemContent flex flex-col items-start justify-center">
            <p class="title !font-semibold">
              Date
            </p>
            <p class="value font-thin">
              {{currentCustomerPaymentDetails?.paymentDate | date}}
            </p>
          </li>
          <li class="itemContent flex flex-col items-start justify-center">
            <p class="title !font-semibold">
              Payment Mode
            </p>
            <p class="value font-thin">
              {{getPaymentMode(currentCustomerPaymentDetails?.paymentMode)}}
            </p>
          </li>
          <li class="itemContent flex flex-col items-start justify-center">
            <p class="title !font-semibold">
              Transaction Id
            </p>
            <p class="value font-thin">
              {{currentCustomerPaymentDetails?.txnid}}
            </p>
          </li>
          <li class="itemContent flex flex-col items-start justify-center">
            <p class="title !font-semibold">
              Amount Paid
            </p>
            <p class="value font-thin">
              <i class="pi pi-indian-rupee" style="font-size: 10px;"></i>{{currentCustomerPaymentDetails?.amount}}
            </p>
          </li>
          <li class="itemContent flex flex-col items-start justify-center">
            <p class="title !font-semibold">
              Payment Status
            </p>
            <p class="value font-thin mt-1">
              @if (currentCustomerPaymentDetails?.paymentStatus === 'success') {
            <p class="px-3 py-1 rounded-md m-0 bg-green-300 text-green-800">
              Success
            </p>
            } @else {
            <p class="px-3 py-1 rounded-md m-0 bg-red-300 text-red-800">
              Failed
            </p>
            }
            </p>
          </li>
        </ul>
      </div>

      @if (customerPaymentHistory.length) {
      <div class="personal-info w-full h-auto py-3">
        <h5 class="block border-b">Past Payments</h5>
        <ul class="grid lg:grid-cols-3 md:grid-cols-2 xl:grid-cols-5 gap-5">
          @for (item of customerPaymentHistory; track $index) {
          <li class="itemContent flex flex-col items-start justify-center">
            <p class="title !font-semibold">
              Date
            </p>
            <p class="value font-thin">
              {{item?.paymentDate | date}}
            </p>
          </li>
          <li class="itemContent flex flex-col items-start justify-center">
            <p class="title !font-semibold">
              Payment Mode
            </p>
            <p class="value font-thin">
              {{getPaymentMode(item?.paymentMode)}}
            </p>
          </li>
          <li class="itemContent flex flex-col items-start justify-center">
            <p class="title !font-semibold">
              Transaction Id
            </p>
            <p class="value font-thin">
              {{item?.txnid}}
            </p>
          </li>
          <li class="itemContent flex flex-col items-start justify-center">
            <p class="title !font-semibold">
              Amount Paid
            </p>
            <p class="value font-thin">
              <i class="pi pi-indian-rupee" style="font-size: 10px;"></i>{{item?.amount}}
            </p>
          </li>
          <li class="itemContent flex flex-col items-start justify-center">
            <p class="title !font-semibold">
              Payment Status
            </p>
            <p class="value font-thin mt-1">
              @if (item?.paymentStatus === 'success') {
            <p class="px-3 py-1 rounded-md m-0 bg-green-300 text-green-800">
              Success
            </p>
            } @else {
            <p class="px-3 py-1 rounded-md m-0 bg-red-300 text-red-800">
              Failed
            </p>
            }
            </p>
          </li>
          }
        </ul>
      </div>
      }
    </div>
    } @else {
    <mt-button title="Complete payment" icon="pi pi-indian-rupee" (action)="showPopup()"></mt-button>
    }
  </div>

</div>

<ng-container>
  <p-dialog #sessionExpired [header]="'Payment'" [(visible)]="showPaymentConfirmationDialog" appendTo="body"
    [modal]="true" [closable]="false" [style]="getDialogStyle()" [draggable]="false" [resizable]="false">
    <div class="flex gap-4 flex-col mt-0 mb-6">
      <div class="flex gap-4 flex-row mt-0">
        <div class="flex items-start justify-center">
          <p-radioButton name="cash" value="cash" [(ngModel)]="paymentMode" inputId="cash1" />
          <label for="cash1" class="ml-2 pl-1 pt-0.5">
            Cash
          </label>
        </div>
        <div class="flex items-start justify-center">
          <p-radioButton name="online" value="online" [(ngModel)]="paymentMode" inputId="online1" />
          <label for="online1" class="ml-2 pl-1 pt-0.5">
            Online
          </label>
        </div>
      </div>
      @if(paymentMode !== 'online'){
      <div class="amount-input gap-2t flex flex-col">
        <label for="amountInput">Amount</label>
        <input pInputText id="amountInput" aria-describedby="amountInput-help" [(ngModel)]="cashAmount"
          style="padding: 0.3rem;" />
      </div>
      }
    </div>
    <div class="flex flex-col items-center justify-center h-full w-full gap-4">
      @if(paymentMode === 'online'){
      <form [formGroup]="formGroup" class="flex flex-col gap-5 w-full">
        <app-input label="First Name" type="text" [control]="formGroupControl['firstName']" formControlName="firstName"
          [controlValue]="formGroup.get('firstName')?.value" />
        <app-input label="Last Name" type="text" [control]="formGroupControl['lastName']" formControlName="lastName"
          [controlValue]="formGroup.get('lastName')?.value" />
        <app-input label="Email" type="text" [control]="formGroupControl['email']" formControlName="email"
          [controlValue]="formGroup.get('email')?.value" />
        <app-input label="Mobile Number" type="text" [control]="formGroupControl['mobile']" formControlName="mobile"
          [controlValue]="formGroup.get('mobile')?.value" />
        <div class="plans">
          <ul class="flex flex-col items-center justify-center md:flex-row gap-2">
            @for (item of cardItems; track $index) {
            <li class="card p-2 rounded-lg border w-full md:flex-1 cursor-pointer" (click)="onPlanClick(item)"
              [ngClass]="item?.isSelected ? 'border-blue-500' : ''">
              <div>
                <div class="header border-b mb-2 flex items-center justify-between">
                  <h1 class="!font-normal !m-0 !text-xs text-center flex-1">
                    {{item.planName}}
                  </h1>
                  <span class="text-blue-500" [ngClass]="{'invisible': !item.isSelected}">
                    <i class="pi pi-check"></i>
                  </span>
                </div>
                <div class="body">
                  <div class="plan-info p-0">
                    <div class="original-price flex flex-col items-center justify-start gap-2">
                      <h1 class="h1-gradient m-0 !text-xs flex items-center justify-center">
                        <span>Amount:&nbsp;</span>
                        <i class="pi pi-indian-rupee !text-xs"></i>
                        <span>{{item.discountAmount}}</span>
                      </h1>
                      <small class="block w-full text-center">(Billed
                        Annually)</small>
                    </div>
                  </div>
                </div>

              </div>
            </li>
            }
          </ul>
        </div>
        <app-input label="Amount" type="text" [control]="formGroupControl['amount']" formControlName="amount"
          [controlValue]="formGroup.get('amount')?.value" />
      </form>
      }

      <div class="action w-full flex items-center justify-end gap-5">
        <mt-button [isCancel]='true' title="Cancel" (action)="showPaymentConfirmationDialog = false" />
        @if(paymentMode === 'online'){
        <mt-button [disabled]="formGroup.invalid || !isAnyCardSelected()" title="Proceed to payment page"
          (action)="handlePayment()" />
        }@else{
        <mt-button title="Submit" (action)="handleSubmit()" />
        }

      </div>
    </div>
  </p-dialog>
</ng-container>